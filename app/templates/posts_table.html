{% from 'modals.html' import view_job_modal, view_job_button %}
{% set visible_fields = options.job_fields|rejectattr('hidden')|list %}

<!-- TODO (maybe): Make rows clickable -- to open job details modal  -->
<table class="table table-dark table-hover caption-top py-0 m-0">
    <caption class="p-0">
        <h2 id="posts-table-label" class="visually-hidden">Job Posts Table</h2>
    </caption>
    <thead>
        <tr class="table-active">
            {% for field in visible_fields %}
            <th scope="col" class="{{ field['type'] }} name-{{ field['name'] }}">{{ field['label'] }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody class="table-group-divider">
        {% for job in jobs %}
        <tr>
            <th scope="row" class="table-active {{ visible_fields[0]['type'] }} name-{{ visible_fields[0]['name'] }}">
                <div>{{ job[visible_fields[0]['name']] }}</div>
            </th>
            {% for field in visible_fields[1::] %}

            <td>
                {% if field['name'] == 'description' %}

                <div class="{{ field['type'] }} name-{{ field['name'] }}">
                    {{ job[field['name']]|truncate(length=145) }}
                </div>
                <div>
                    {{ view_job_button(job) }}
                </div>

                {% elif field['type'] == 'link' %}
                <a target="_blank" href="{{ job[field['name']] }}"
                    class="{{ field['type'] }} name-{{ field['name'] }}">View on {{ job['job_board'] }}
                </a>
                {% elif field['type'] == 'date' %}
                <div class="{{ field['type'] }} name-{{ field['name'] }}">
                    {{ job[field['name']].strftime('%B %d, %Y') if job[field['name']] }}
                </div>
                {% else %}
                <div class="{{ field['type'] }} name-{{ field['name'] }}">{{ job[field['name']] }}</div>
                {% endif %}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>


{% for job in jobs %}

{{ view_job_modal(job) }}

{% endfor %}