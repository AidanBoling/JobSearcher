{% extends "base.html" %}

{% block page_title %}Home{% endblock %}

{% block content %}

<!-- TODO: Move this live region to a better location. -->
<div role="status" aria-live="polite">
    <!-- add content to hear it spoken -->
</div>

<h1 id="posts-table-label">Job Posts</h1>
{% if not jobs %}
<div class="border border-black border-2 rounded-2 container-md p-5">
    <p>No jobs here yet. Go to settings to set up options and run a search manually.</p>
</div>

{% else %}
<div class="table-container border border-black border-2 rounded-2 vh-75 container-md p-0">
    <!-- <div class="empty-state">
        <p>No job posts here yet. Click the button to run a search manually.</p>
    </div> -->
    {% include 'posts_table.html' %}
</div>

<br />
<!-- Table Settings -->
<h2>Table Settings</h2>
{% include 'posts_table_settings.html' %}
<br />
<h2>Filters</h2>
{% include 'data_filters.html' %}
<br />

{% endif %}

{% endblock %}
{% block scripts %}
{{ super() }}

<script>

    const all_filters = {{ filters | tojson }}

    function getFilterSettings(inputId, selectedOption) {
        console.log('selected option: ', selectedOption)
        const filterNum = inputId.split('-')[1]
        console.log('Filter number: ', filterNum)

        console.log('all_filters: ', all_filters)

        const filter = all_filters[selectedOption]
        console.log('selected_filter: ', filter)

        function getOptionsText(valuesLabelsList) {
            let options = ''
            valuesLabelsList.forEach((valueLabel, i) => {
                selected = ''
                if (i === 0) { selected = 'selected ' }
                options += `<option ${selected}value="${valueLabel[0]}">${valueLabel[1]}</option>`
            })

            return options
        }

        const operatorOptions = getOptionsText(filter['op_list'])

        const operatorSelect = document.getElementById('filter_operator-' + filterNum)
        operatorSelect.innerHTML = operatorOptions
        operatorSelect.classList.remove('d-none')


        // Repeat for field values... (set field according to input_type)
        const valueDiv = document.getElementById('filter_value-' + filterNum)
        // if (valueElement) { valueElement.remove() }

        if (filter['input_type'] === 'multi-select') {
            const valueOptions = getOptionsText(filter.values)
            const valueElementHTML = `<select class="form-select" name="value" id="filter_value-${filterNum}" aria-label="Value">${valueOptions}</select>`
            valueDiv.innerHTML(valueElementHTML)
        }
        // else if (filter['input_type'] === 'text') {
        // 
        // }
        // else if (filter['input_type'] === 'date') { }
        // else if (filter['input_type'] === 'number') { }




        // // ...Or, could get filter option data by fetch, and get the entire option list, or entire div maybe...
        // element = getElementById('...') //...

        // let data = new FormData()
        // data.append('name', options_value)
        // {# url = {{ url_for('filter_options') | tojson }} #}

        // get_html(url, selected_option).then(text => element.innerHTML = text)
    }

    function get_html(url, data) {

        request = {
            "method": "POST",
            "body": data,
        }

        return fetch(room_url, request)
            .then(response => response.text)
        // .then(text => element.innerHTML = text)
    }

    // TODO: Use fetch pattern to create a new filter input row when click an "Add filter" button


    // example LIVE REGION script -- for alert/status messages to be read by Voice Readers 
    // var todoName = document.querySelector('[type="text"]').value;
    // const formBtn = document.querySelector(".settings-btn");

    function announceSave() {
        // const testButton = document.querySelector("#test-button");
        // testButton.text = ''

        const liveRegion = document.querySelector('[role="status"]');
        liveRegion.textContent = `Settings were saved.`;
        setTimeout(() => { liveRegion.textContent = '' }, 5000)
    }

    // formBtn.addEventListener("click", announceSave());

</script>
{% endblock %}